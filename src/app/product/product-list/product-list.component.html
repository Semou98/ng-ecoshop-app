<div class="container py-4">
  <ng-container *ngIf="viewModel$ | async as vm">
    <div class="row g-4">

      <!-- Section filtres -->
      <div class="col-12 col-md-3">
        <div class="filter-card bg-white shadow-sm rounded p-3">
          <!-- Recherche et filtres -->
          <app-product-search
            (searchResults)="onSearchResults($event)"
            class="mb-4"
          ></app-product-search>
          <app-product-filter
            (filterChange)="onFilterChange($event)"
          ></app-product-filter>
        </div>
      </div>

      <!-- Grille de produits -->
      <div class="col-12 col-md-9">
        <!-- Header catalogue produits -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2 class="h4 mb-0">Nos produits</h2>
            <small class="text-muted">
              {{ vm.filteredProducts.length }} produit(s) trouvé(s)
            </small>
          </div>
          <button 
            class="eco-btn d-flex align-items-center"
            (click)="onCreateProduct()">
            <i class="bi bi-plus-circle me-2"></i>
            Nouveau produit
          </button>
        </div>

        <div class="row g-4">
          <div *ngFor="let product of (vm.searchResults?.length ? vm.searchResults : vm.filteredProducts)" class="col-12 col-sm-6 col-lg-4">
            <!-- Affichage des produits dans des carts -->
            <app-product-cart
              [product]="product"
              (addToCart)="onAddToCart($event)"
              [routerLink]="['/product', product.id]"
              class="h-100"
            ></app-product-cart>
          </div>
        </div>

        <!-- Message si aucun produit -->
        <div *ngIf="vm.filteredProducts.length === 0 && !vm.loading" 
             class="text-center py-5">
          <p class="text-muted">Aucun produit ne correspond à vos critères</p>
        </div>
      </div>
    </div>

    <!-- Loader -->
    <div *ngIf="vm.loading" class="position-fixed top-50 start-50 translate-middle">
      <div class="spinner-border text-success" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
    </div>
  </ng-container>
</div>